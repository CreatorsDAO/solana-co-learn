---
sidebar_position: 67
sidebar_label: ğŸ§ PDA æ·±å…¥æ¢ç©¶
sidebar_class_name: green
---

# ğŸ§ PDA æ·±å…¥æ¢ç©¶

å•Šï¼Œé¸¡è›‹ã€‚æˆ–è€…æ­£å¼ç§°ä¹‹ä¸ºï¼šç¨‹åºæ´¾ç”Ÿåœ°å€ã€‚æˆ‘ä»¬ä¹‹å‰å·²ç»ç”¨å®ƒä»¬çƒ¹é¥ªè¿‡ã€‚è®©æˆ‘ä»¬æ‰“å¼€å®ƒä»¬çœ‹çœ‹å®ƒä»¬æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚

PDAä¸»è¦æœ‰ä¸¤ä¸ªä¸»è¦åŠŸèƒ½ï¼š

- æä¾›ä¸€ç§[ç¡®å®šæ€§](https://www.google.com.hk/search?q=define+deterministic&utm_source=buildspace.so&utm_medium=buildspace_project)çš„æ–¹æ³•æ¥æŸ¥æ‰¾ç¨‹åºæ‹¥æœ‰çš„è´¦æˆ·çš„åœ°å€
- æˆæƒæ´¾ç”Ÿè‡ªPDAçš„ç¨‹åºä»£è¡¨å…¶ç­¾ç½²ï¼Œå°±åƒç”¨æˆ·å¯ä»¥ä½¿ç”¨ä»–ä»¬çš„ç§é’¥ç­¾ç½²ä¸€æ ·

æ¢å¥è¯è¯´ï¼Œå®ƒä»¬æ˜¯Solanaç½‘ç»œä¸Šç”¨äºå­˜å‚¨çš„å®‰å…¨é”®å€¼å­˜å‚¨ã€‚

## ğŸ” å¯»æ‰¾ PDAs (PDAs)

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ¯å½“æˆ‘ä»¬éœ€è¦æ´¾ç”Ÿä¸€ä¸ªåœ°å€æ—¶ï¼Œæˆ‘ä»¬éƒ½ä½¿ç”¨äº†ä¸€ä¸ªæ–¹ä¾¿çš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°åˆ°åº•æ˜¯åšä»€ä¹ˆçš„å‘¢ï¼Ÿè¦æ‰¾å‡ºç­”æ¡ˆï¼Œæˆ‘ä»¬éœ€è¦äº†è§£Solanaå¯†é’¥å¯¹æ˜¯å¦‚ä½•ç”Ÿæˆçš„ã€‚

å›æƒ³ä¸€ä¸‹å¯†é’¥å¯¹çš„ä½œç”¨ã€‚å®ƒæ˜¯ä¸€ç§è¯æ˜ä½ æ˜¯ä½ æ‰€è¯´çš„é‚£ä¸ªäººçš„æ–¹å¼ã€‚æˆ‘ä»¬ä½¿ç”¨æ•°å­—ç­¾åç³»ç»Ÿæ¥å®ç°è¿™ä¸€ç‚¹ã€‚Solanaçš„å¯†é’¥å¯¹æ˜¯åŸºäºæ‰€è°“çš„Ed25519æ¤­åœ†æ›²çº¿ï¼ˆä½ ä¸éœ€è¦çŸ¥é“è¿™æ˜¯ä»€ä¹ˆé¬¼ä¸œè¥¿ï¼‰ã€‚

![](./img/pda.png)

ç”±äº`PDAs`æ˜¯ç”±ç¨‹åºæ§åˆ¶çš„ï¼Œæ‰€ä»¥å®ƒä»¬ä¸éœ€è¦ç§é’¥ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸åœ¨Ed25519æ›²çº¿ä¸Šçš„åœ°å€æ¥åˆ›å»ºPDAsã€‚è¿™å®é™…ä¸Šæ„å‘³ç€å®ƒä»¬æ˜¯æ²¡æœ‰ç›¸åº”ç§é’¥çš„å…¬é’¥ã€‚

å°±æ˜¯è¿™æ ·ã€‚ä½ ä¸éœ€è¦ç†è§£Ed25519ï¼Œç”šè‡³ä¸éœ€è¦çŸ¥é“æ•°å­—ç­¾åç®—æ³•æ˜¯ä»€ä¹ˆã€‚ä½ åªéœ€è¦çŸ¥é“PDAçœ‹èµ·æ¥åƒæ™®é€šçš„Solanaåœ°å€ï¼Œå¹¶ä¸”ç”±ç¨‹åºæ§åˆ¶ã€‚å¦‚æœä½ æƒ³è¿›ä¸€æ­¥äº†è§£ï¼Œå¯ä»¥çœ‹çœ‹Computerphileå…³äº[æ•°å­—ç­¾å](https://www.youtube.com/watch?v=s22eJ1eVLTU&utm_source=buildspace.so&utm_medium=buildspace_project)çš„é…·ç‚«è§†é¢‘ã€‚


è¦åœ¨Solanaç¨‹åºä¸­æ‰¾åˆ°ä¸€ä¸ªPDAï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ find_program_address å‡½æ•°ã€‚

â€œç§å­â€æ˜¯ç”¨äºæ´¾ç”ŸPDAçš„ find_program_address å‡½æ•°çš„å¯é€‰è¾“å…¥ã€‚ä¾‹å¦‚ï¼Œç§å­å¯ä»¥æ˜¯ä»»æ„ç»„åˆï¼š

- æŒ‡ä»¤æ•°æ®
- ç¡¬ç¼–ç çš„å€¼
- å…¶ä»–è´¦æˆ·çš„å…¬é’¥

find_program_address å‡½æ•°æä¾›äº†ä¸€ä¸ªé¢å¤–çš„ç§å­ï¼Œç§°ä¸ºâ€œbump seedâ€ï¼Œä»¥ç¡®ä¿ç»“æœä¸åœ¨Ed25519æ›²çº¿ä¸Š

ä¸€æ—¦æ‰¾åˆ°æœ‰æ•ˆçš„PDAï¼Œè¯¥å‡½æ•°å°†è¿”å›ä¸¤ä¸ªå€¼ï¼š

- PDA
- the bump that was used to derive the PDA

![](./img/find-pda.png)


```rust
let (pda, bump_seed) = Pubkey::find_program_address(&[user.key.as_ref(), user_input.as_bytes().as_ref(), "SEED".as_bytes()], program_id)
```


## ğŸ³ Under the hood of find_program_address

find_program_address æ˜¯ä¸€ä¸ªå†’ç‰Œè´§ - å®ƒå®é™…ä¸Šå°†è¾“å…¥ seeds å’Œ program_id ä¼ é€’ç»™ try_find_program_address å‡½æ•°

![](./img/find-program-address.png)


```rust
pub fn find_program_address(seeds: &[&[u8]], program_id: &Pubkey) -> (Pubkey, u8) {
    Self::try_find_program_address(seeds, program_id)
        .unwrap_or_else(|| panic!("Unable to find a viable program address bump seed"))
}
```

ç„¶åï¼Œ try_find_program_address å‡½æ•°å¼•å…¥äº† bump_seed ã€‚

bump_seed æ˜¯ä¸€ä¸ª u8 å˜é‡ï¼Œå…¶å€¼èŒƒå›´åœ¨0åˆ°255ä¹‹é—´ï¼Œå®ƒè¢«é™„åŠ åˆ°å¯é€‰çš„è¾“å…¥ç§å­ä¸­ï¼Œç„¶åä¼ é€’ç»™ create_program_address å‡½æ•°

![](./img/try-find-program-address.png)

```rust
pub fn try_find_program_address(seeds: &[&[u8]], program_id: &Pubkey) -> Option<(Pubkey, u8)> {

    let mut bump_seed = [std::u8::MAX];
    for _ in 0..std::u8::MAX {
        {
            let mut seeds_with_bump = seeds.to_vec();
            seeds_with_bump.push(&bump_seed);
            match Self::create_program_address(&seeds_with_bump, program_id) {
                Ok(address) => return Some((address, bump_seed[0])),
                Err(PubkeyError::InvalidSeeds) => (),
                _ => break,
            }
        }
        bump_seed[0] -= 1;
    }
    None

}
```

create_program_address å‡½æ•°å¯¹ç§å­å’Œ program_id æ‰§è¡Œä¸€ç³»åˆ—å“ˆå¸Œæ“ä½œã€‚è¿™äº›æ“ä½œè®¡ç®—ä¸€ä¸ªå¯†é’¥ï¼Œç„¶åéªŒè¯è®¡ç®—å‡ºçš„å¯†é’¥æ˜¯å¦ä½äºEd25519æ¤­åœ†æ›²çº¿ä¸Šã€‚

å¦‚æœæ‰¾åˆ°ä¸€ä¸ªæœ‰æ•ˆçš„PDAï¼ˆå³ä¸€ä¸ªä¸åœ¨æ›²çº¿ä¸Šçš„åœ°å€ï¼‰ï¼Œåˆ™è¿”å›è¯¥PDAã€‚å¦åˆ™ï¼Œè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚

![](./img/create-program-address.png)

```rust
pub fn create_program_address(
    seeds: &[&[u8]],
    program_id: &Pubkey,
) -> Result<Pubkey, PubkeyError> {

    let mut hasher = crate::hash::Hasher::default();
    for seed in seeds.iter() {
        hasher.hash(seed);
    }
    hasher.hashv(&[program_id.as_ref(), PDA_MARKER]);
    let hash = hasher.result();

    if bytes_are_curve_point(hash) {
        return Err(PubkeyError::InvalidSeeds);
    }

    Ok(Pubkey::new(hash.as_ref()))

}
```

æ€»ç»“ä¸€ä¸‹ï¼š

- è¯¥å‡½æ•°å°†æˆ‘ä»¬çš„è¾“å…¥ç§å­å’Œ program_id ä¼ é€’ç»™ try_find_program_address å‡½æ•°ã€‚
- try_find_program_address å‡½æ•°å°†ä¸€ä¸ª bump_seed ï¼ˆä»255å¼€å§‹ï¼‰æ·»åŠ åˆ°æˆ‘ä»¬çš„è¾“å…¥ç§å­ä¸­ï¼Œç„¶åè°ƒç”¨ create_program_address å‡½æ•°ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªæœ‰æ•ˆçš„PDAã€‚
- ä¸€æ—¦æ‰¾åˆ°ï¼ŒPDAå’Œ bump_seed éƒ½ä¼šè¢«å½’è¿˜ã€‚

ä½ ä¸éœ€è¦è®°ä½æ‰€æœ‰çš„ç»†èŠ‚ï¼é‡è¦çš„æ˜¯è¦ç†è§£åœ¨é«˜å±‚æ¬¡ä¸Šè°ƒç”¨ find_program_address å‡½æ•°æ—¶å‘ç”Ÿäº†ä»€ä¹ˆã€‚

## ğŸ¤” å…³äºï¼ˆPDAï¼‰çš„æ³¨æ„äº‹é¡¹
