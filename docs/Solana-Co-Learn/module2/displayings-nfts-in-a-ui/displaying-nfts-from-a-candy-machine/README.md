---
sidebar_position: 39
sidebar_label: ğŸ–¼ ä»ç³–æœæœºå±•ç¤ºNFTs
sidebar_class_name: green
tags:
  - displayings-nfts
  - solana
  - nft
  - metaplex
  - candy
---

# ğŸ–¼ ä»ç³–æœæœºå±•ç¤ºNFTs

ç°åœ¨æˆ‘ä»¬å·²ç»é“¸é€ äº†ä¸€ä¸ª`NFT`ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•é“¸é€ ä¸€ç³»åˆ—çš„`NFT`ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†åˆ©ç”¨Candy Machineæ¥å®ç°â€”â€”è¿™æ˜¯`Solana`çš„ä¸€ä¸ªç¨‹åºï¼Œä½¿åˆ›ä½œè€…èƒ½å¤Ÿå°†ä»–ä»¬çš„èµ„äº§ä¸Šé“¾ã€‚è™½ç„¶è¿™å¹¶éåˆ›å»ºç³»åˆ—çš„å”¯ä¸€æ–¹å¼ï¼Œä½†åœ¨`Solana`ä¸Šå®ƒå´æˆäº†æ ‡å‡†ï¼Œå› ä¸ºå®ƒå…·å¤‡äº†è®¸å¤šæœ‰ç”¨çš„åŠŸèƒ½ï¼Œä¾‹å¦‚æœºå™¨äººä¿æŠ¤å’Œå®‰å…¨éšæœºåŒ–ã€‚ä½ æ˜¯å¦æ„Ÿå—åˆ°è¿‡çœ‹åˆ°é—ªäº®çš„æ–°iPhoneæ—¶çš„é‚£è‚¡å…´å¥‹æ„Ÿï¼Ÿç¨€æœ‰çš„`NFT`æœ‰ç‚¹å„¿ç±»ä¼¼äºæ­¤ã€‚å¯¹äºä¼˜ç§€çš„è‰ºæœ¯å®¶è€Œè¨€ï¼Œä»…ä»…æ˜¯è§‚çœ‹è¿™äº›`NFT`ä¹Ÿæå¯Œä¹è¶£ã€‚æ¯•ç«Ÿï¼Œè‰ºæœ¯çš„æœ¬è´¨å°±æ˜¯ç”¨æ¥æ¬£èµçš„ï¼æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ¢è®¨å¦‚æœæˆ‘ä»¬åªæœ‰`Candy Machine`çš„åœ°å€ï¼Œåº”è¯¥å¦‚ä½•å±•ç¤º`NFTs`ã€‚

ä½ èƒ½çŒœåˆ°è¿™é‡Œæœ‰ä½•ä¸åŒä¹‹å¤„å—ï¼Ÿæ²¡é”™ï¼Œæˆ‘ä»¬ä»…åœ¨`SDK`ä¸Šé‡‡ç”¨äº†ä¸€ç§ä¸åŒçš„æ–¹æ³•ï¼

![](./img/candy-machine-nft.png)

ç”±äºè¿™é‡Œå¹¶æ²¡æœ‰é’±åŒ…ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä½¿ç”¨ `walletAdapterIdentity`ï¼Œåªéœ€ä½¿ç”¨`metaplex`å¯¹è±¡å³å¯ã€‚

![](./img/find-nf.png)

æˆ‘ä»¬åœ¨æ­¤æœ‰å‡ ä¸ªé€‰æ‹© - `findByAddress` å°±æ˜¯æˆ‘ä»¬æ‰€éœ€çš„ã€‚

![](./img/find-by-address.png)

ä¸æˆ‘ä»¬ä¸ºå•ä¸ª`NFT`æ‰€è·å–çš„ç›¸ä¼¼ï¼Œæˆ‘ä»¬å°†ä¼šå¾—åˆ°æ•´ä¸ªç³–æœæœºå®ä¾‹çš„å…ƒæ•°æ®ã€‚`items` å­—æ®µæ˜¯ç³–æœæœºå†…æ‰€æœ‰`NFT`çš„æ•°ç»„ã€‚æ¯ä¸ªé¡¹ç›®éƒ½ä¸ä¼šç›´æ¥åŒ…å«æˆ‘ä»¬æƒ³è¦çš„å†…å®¹ï¼Œè€Œæ˜¯ä¼šå¼•å‘ä¸€ä¸ªæˆ‘ä»¬å¯ä»¥ä»ä¸­æå–èµ„äº§çš„URIã€‚

![](./img/find-by-address-result.png)

é‰´äºæ”¶è—å“å¯èƒ½ä¼šç›¸å½“åºå¤§ï¼Œæˆ‘ä»¬ä¸ä¼šä¸€æ¬¡æ€§è·å–æ‰€æœ‰çš„`NFT`ã€‚ç›¸åï¼Œæˆ‘ä»¬å°†åŸºäºåˆ†é¡µç³»ç»Ÿï¼Œåªè·å–æˆ‘ä»¬æƒ³è¦å±•ç¤ºçš„`NFT`ã€‚

é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥ç»˜åˆ¶ä¸€äº›åƒç´ å§ï¼

## ğŸ¥ è¯·å‡†å¤‡ä¸€ä¸ªç³–æœæœº

ä½ å¯ä»¥ä»ä¸Šä¸€èŠ‚çš„è¿›åº¦ç»§ç»­ï¼Œæˆ–è€…ä½¿ç”¨æˆ‘ä»¬ä¸Šæ¬¡ä½¿ç”¨çš„ç›¸åŒæ¨¡æ¿ï¼ˆä»èµ·å§‹åˆ†æ”¯å¼€å§‹å³å¯ï¼‰ã€‚

èµ¶ç´§è·³å…¥ `FetchCandyMachine.tsx` æ–‡ä»¶å§ã€‚ä½ ä¼šå‘ç°ä¸€äº›è®¾ç½®å·²ç»ä¸ºä½ å‡†å¤‡å¥½äº†ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ `getPage` å‡½æ•°ä»ç³–æœæœºä¸Šè·å–æŸâ€œé¡µé¢â€ä¸Šçš„ç‰©å“ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦è·å–ç³–æœæœºçš„å…ƒæ•°æ®è´¦æˆ·ã€‚

åœ¨ç©ºçš„ `fetchCandyMachine` å‡½æ•°ä¸Šæ–¹è®¾ç½® `metaplex` å¯¹è±¡çš„è¿æ¥ã€‚

```js
export const FetchCandyMachine: FC = () => {
  // å ä½ç¬¦ CMv2 åœ°å€
  const [candyMachineAddress, setCandyMachineAddress] = useState("")
  const [candyMachineData, setCandyMachineData] = useState(null)
  const [pageItems, setPageItems] = useState(null)
  const [page, setPage] = useState(1)

  const { connection } = useConnection()
  const metaplex = Metaplex.make(connection)
  ```

åœ¨åˆ›å»ºæœ‰çŠ¶æ€å˜é‡æ—¶ï¼Œè¯·ç¡®ä¿æ·»åŠ ä½ çš„`Candy Machine`åœ°å€ã€‚

```js
export const FetchCandyMachine: FC = () => {
  const [candyMachineAddress, setCandyMachineAddress] = useState("CM_ADDRESS_HERE")
  ...
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å®Œå–„ `fetchCandyMachine` å‡½æ•°ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¹‹å‰çœ‹åˆ°çš„ `findByAddress` æ–¹æ³•ã€‚

```js
export const FetchCandyMachine: FC = () => {
  ...

  // é€šè¿‡åœ°å€è·å–ç³–æœæœº
  const fetchCandyMachine = async () => {

    // è®¾ç½®é¡µé¢ä¸º1 - æˆ‘ä»¬æƒ³è¦åœ¨è·å–æ–°ç³–æœæœºæ—¶å§‹ç»ˆä½äºç¬¬ä¸€é¡µ
    setPage(1)

    // è·å–ç³–æœæœºæ•°æ®
    try {
      const candyMachine = await metaplex
        .candyMachinesV2()
        .findByAddress({ address: new PublicKey(candyMachineAddress) })

      setCandyMachineData(candyMachine)
    } catch (e) {
      alert("è¯·è¾“å…¥æœ‰æ•ˆçš„CMv2åœ°å€ã€‚")
    }
  }
  ...
}
```

æ³¨æ„ï¼š`Metaplex CLI`çš„æœ€æ–°ç‰ˆæœ¬åœ¨å‡½æ•°è°ƒç”¨çš„æœ«å°¾ä¸éœ€è¦ `run()`ã€‚

ç°åœ¨æ¥åˆ°é‡è¦çš„éƒ¨åˆ† - æµè§ˆæˆ‘ä»¬å°†è·å–çš„CMæ•°æ®ã€‚ä»¥ä¸‹æ˜¯ `getPage` å‡½æ•°çš„æ ·å­ï¼š

```js
export const FetchCandyMachine: FC = () => {
  ...

  // åˆ†é¡µ
  const getPage = async (page, perPage) => {
    const pageItems = candyMachineData.items.slice(
      (page - 1) * perPage,
      page * perPage
    )

    // è·å–é¡µé¢ä¸­NFTçš„å…ƒæ•°æ®
    let nftData = []
    for (let i = 0; i < pageItems.length; i++) {
      let fetchResult = await fetch(pageItems[i].uri)
      let json = await fetchResult.json()
      nftData.push(json)
    }

    // è®¾ç½®çŠ¶æ€
    setPageItems(nftData)
  }
  ...
}

```

æˆ‘ä»¬åœ¨è¿™é‡Œåšçš„æ˜¯å°† `items` æ•°ç»„åˆ‡å‰²æˆå¤§å°ä¸º`10`çš„éƒ¨åˆ†ã€‚ç„¶åæˆ‘ä»¬è·å–é¡µé¢ä¸Šæ¯ä¸ª`NFT`çš„å…ƒæ•°æ®ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ `nftData` ä¸­ã€‚æœ€åï¼Œæˆ‘ä»¬å°† `pageItems` çŠ¶æ€å˜é‡è®¾ç½®ä¸ºåˆšåˆšè·å–çš„ `nftData`ã€‚

è¿™æ„å‘³ç€æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåœ¨ä»»ä½•æ—¶å€™åªä¼šæ¸²æŸ“å½“å‰é¡µé¢çš„`NFT`ã€‚ç›¸å½“æ£’ï¼

è®©æˆ‘ä»¬å¡«å†™ `prev` å’Œ `next` å‡½æ•°ï¼š

```js
// ä¸Šä¸€é¡µ
const prev = async () => {
  if (page - 1 < 1) {
    setPage(1)
  } else {
    setPage(page - 1)
  }
}

// ä¸‹ä¸€é¡µ
const next = async () => {
  setPage(page + 1)
}
```

å½“ç”¨æˆ·ç‚¹å‡»â€œä¸Šä¸€é¡µâ€å’Œâ€œä¸‹ä¸€é¡µâ€æŒ‰é’®æ—¶ï¼Œè¿™äº›åŠŸèƒ½å°†è¿è¡Œã€‚è¿™äº›æŒ‰é’®åªä¼šåœ¨ `pageItems` ä¸ä¸ºç©ºæ—¶æ˜¾ç¤ºï¼ˆå³å½“æˆ‘ä»¬è·å–äº†CMçš„`NFT`æ—¶ï¼‰ã€‚

ç°åœ¨æˆ‘ä»¬éœ€è¦ä¸€äº› `useEffects` æ¥å¼€å§‹ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸€å¼€å§‹å¯èƒ½æœ‰ç‚¹å¤æ‚ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥è§£é‡Šã€‚

- 1. åœ¨é¡µé¢åŠ è½½æ—¶è¿è¡Œ `fetchCandyMachine` å‡½æ•°ï¼ˆå¦‚æœ `candyMachineAddress` ä¸ä¸ºç©ºï¼‰ã€‚
- 2. æ¯å½“ä½¿ç”¨ `fetchCandyMachine` è·å–ç³–æœæœºæ—¶ï¼Œå°† `page` è®¾ç½®ä¸º`1`ï¼Œè¿™æ ·ä½ å°±å¯ä»¥ä»ç¬¬ä¸€é¡µå¼€å§‹ã€‚
- 3. æ¯å½“ `candyMachineData` æˆ– `page` å‘ç”Ÿå˜åŒ–æ—¶ï¼ˆå³è¾“å…¥æ–°çš„CMåœ°å€æˆ–ç‚¹å‡»ä¸‹ä¸€ä¸ª/ä¸Šä¸€ä¸ªæŒ‰é’®ï¼‰ï¼Œé‡æ–°åŠ è½½é¡µé¢ã€‚

ä»¥ä¸‹æ˜¯ä»£ç ç¤ºä¾‹ï¼š

```js
export const FetchCandyMachine: FC = () => {
  ...

  // é¡µé¢åŠ è½½æ—¶è·å–å ä½ç¬¦ç³–æœæœº
  useEffect(() => {
    fetchCandyMachine()
  }, [])

  // å½“é¡µé¢æˆ–ç³–æœæœºå‘ç”Ÿå˜åŒ–æ—¶è·å–NFTçš„å…ƒæ•°æ®
  useEffect(() => {
    if (!candyMachineData) {
      return
    }
    getPage(page, 9)
  }, [candyMachineData, page])

}
```

å¿«åˆ° `localhost:3000` ä¸Šè¯•è¯•å§ï¼ä½ åº”è¯¥èƒ½å¤Ÿçœ‹åˆ°ä½ çš„ç³–æœæœºä¸Š`NFT`çš„ç¬¬ä¸€é¡µã€‚
